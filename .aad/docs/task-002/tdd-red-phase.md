# TDD Red フェーズ - task-002

## タスク情報
- **Task ID**: task-002
- **タイトル**: バックエンドAPIサーバーのセットアップ
- **説明**: Node.js + Express.jsでTodo APIサーバーを構築する

## 実行日時
2026-02-05

## テスト戦略
Node.js + Express.jsアプリケーションに対して、以下のテスト戦略を採用:
- **テストフレームワーク**: Jest
- **HTTPテスト**: supertest
- **テストパターン**: test.each()を使用したテーブル駆動テスト風のアプローチ

## 作成したテストケース

### 1. Todo API Endpoints（基本的なCRUD操作）
| メソッド | エンドポイント | 説明 | 期待ステータス |
|---------|--------------|------|--------------|
| GET | /todos | すべてのTodoを取得 | 200 |
| POST | /todos | 新しいTodoを作成 | 201 |
| PUT | /todos/:id | Todoを更新 | 200 |
| DELETE | /todos/:id | Todoを削除 | 200 |

### 2. データベース接続テスト
- db.jsモジュールの存在確認
- poolオブジェクトの定義確認

### 3. 環境変数テスト
- ポート3001での起動設定確認

### 4. エラーハンドリングテスト
| メソッド | エンドポイント | 説明 | 期待ステータス |
|---------|--------------|------|--------------|
| GET | /todos/999 | 存在しないTodoを取得 | 404 |
| PUT | /todos/999 | 存在しないTodoを更新 | 404 |
| DELETE | /todos/999 | 存在しないTodoを削除 | 404 |
| POST | /todos | 不正なデータで作成 | 400 |

## テスト実行結果（Red フェーズ）

```
Test Suites: 1 failed, 1 total
Tests:       6 failed, 4 passed, 10 total
Time:        0.396 s
```

### 失敗したテスト（期待通り）
1. ✗ GET /todos - すべてのTodoを取得できること
   - 期待: 200, 実際: 404

2. ✗ POST /todos - 新しいTodoを作成できること
   - 期待: 201, 実際: 404

3. ✗ PUT /todos/1 - Todoを更新できること
   - 期待: 200, 実際: 404

4. ✗ DELETE /todos/1 - Todoを削除できること
   - 期待: 200, 実際: 404

5. ✗ データベースに接続できること
   - 理由: db.jsモジュールが存在しない

6. ✗ POST /todos - 不正なデータで作成しようとした場合、400を返すこと
   - 期待: 400, 実際: 404

### パスしたテスト
1. ✓ ポート3001で起動する設定になっていること
2. ✓ GET /todos/999 - 存在しないTodoを取得しようとした場合、404を返すこと
3. ✓ PUT /todos/999 - 存在しないTodoを更新しようとした場合、404を返すこと
4. ✓ DELETE /todos/999 - 存在しないTodoを削除しようとした場合、404を返すこと

## 作成したファイル
1. `backend/package.json` - プロジェクト設定とテスト用依存関係
2. `backend/__tests__/api.test.js` - Todo APIのテストスイート
3. `backend/jest.config.js` - Jestの設定ファイル
4. `backend/env.example` - 環境変数のサンプル
5. `backend/README.md` - プロジェクトドキュメント

## 次のステップ（Green フェーズ）
以下の実装が必要:
1. `server.js` - Expressアプリケーションのセットアップ
2. `db.js` - PostgreSQL接続プール
3. Todo APIのエンドポイント実装（GET/POST/PUT/DELETE）
4. リクエストバリデーション
5. エラーハンドリング

## 結論
✅ **TDD Redフェーズは成功**

すべてのテストが期待通りに失敗しました。これは、実装コードがまだ存在しないためです。
次のフェーズ（Green）で、これらのテストをパスさせる最小限の実装を行います。
