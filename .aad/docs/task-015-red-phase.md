# Task-015: 認証関連コンポーネントの実装 - Red Phase

## 概要

task-015「認証関連コンポーネントの実装」のTDD Redフェーズを実行しました。
LoginFormとRegisterFormコンポーネントの包括的なE2Eテストを作成しました。

## 実施日時

- 2026-02-06 14:19-14:25 (初回実行)
- 2026-02-06 14:40-14:45 (検証・最終確認)

## タスク情報

- **Task ID**: task-015
- **Task Title**: 認証関連コンポーネントの実装
- **Task Description**: LoginForm, RegisterFormなど認証関連のコンポーネントを実装

## プロジェクト情報

- **Workspace**: /Users/kazuki/workspace/sandbox/worktrees/_20260205_153345-wt-task-015/frontend
- **Language**: TypeScript
- **Framework**: React 19.2.0
- **Test Framework**: Playwright 1.58.1
- **Build Tool**: Vite 7.2.4

## 作成したテスト

### ファイル

`frontend/e2e/auth.spec.ts`

### テストケース数

合計: **24テストケース**

#### LoginForm コンポーネント (9テストケース)

1. ログインフォームが表示される
2. メールアドレス入力フィールドが表示される
3. パスワード入力フィールドが表示される
4. ログインボタンが表示される
5. 空のフォーム送信時にバリデーションエラーが表示される
6. 無効なメールアドレス形式でエラーが表示される
7. 正しいメールアドレスとパスワードでログインできる
8. 間違った認証情報でログインエラーが表示される
9. パスワードの表示/非表示切り替えができる

#### RegisterForm コンポーネント (13テストケース)

1. 会員登録フォームが表示される
2. ユーザー名入力フィールドが表示される
3. メールアドレス入力フィールドが表示される
4. パスワード入力フィールドが表示される
5. パスワード確認入力フィールドが表示される
6. 登録ボタンが表示される
7. 空のフォーム送信時にバリデーションエラーが表示される
8. パスワードが一致しない場合エラーが表示される
9. パスワードが短すぎる場合エラーが表示される
10. 無効なメールアドレス形式でエラーが表示される
11. 正しい情報で会員登録できる
12. 既に登録済みのメールアドレスでエラーが表示される
13. パスワードの表示/非表示切り替えができる

#### 認証フロー統合 (2テストケース)

1. ログインページから会員登録ページへのリンクが機能する
2. 会員登録ページからログインページへのリンクが機能する

## テスト設計方針

### data-testid 命名規則

以下の命名規則に従ってテストIDを設計しました:

#### LoginForm
- `login-link`: ログインページへのナビゲーションリンク
- `login-form`: ログインフォームコンテナ
- `login-email`: メールアドレス入力フィールド
- `login-password`: パスワード入力フィールド
- `login-submit`: ログインボタン
- `login-error`: エラーメッセージ表示エリア
- `password-toggle`: パスワード表示/非表示トグルボタン
- `to-register-link`: 会員登録ページへのリンク

#### RegisterForm
- `register-link`: 会員登録ページへのナビゲーションリンク
- `register-form`: 会員登録フォームコンテナ
- `register-username`: ユーザー名入力フィールド
- `register-email`: メールアドレス入力フィールド
- `register-password`: パスワード入力フィールド
- `register-password-confirm`: パスワード確認入力フィールド
- `register-submit`: 登録ボタン
- `register-error`: エラーメッセージ表示エリア
- `register-success`: 成功メッセージ表示エリア
- `password-toggle`: パスワード表示/非表示トグルボタン
- `to-login-link`: ログインページへのリンク

#### 共通
- `user-info`: ログイン後のユーザー情報表示エリア

### バリデーション要件

#### メールアドレス
- 形式バリデーション: 正規表現によるメールアドレス形式のチェック
- 必須バリデーション: 空欄不可

#### パスワード
- 最小文字数: 8文字以上（推奨）
- 必須バリデーション: 空欄不可
- 表示/非表示切り替え機能

#### RegisterForm固有
- パスワード確認: 2つのパスワードフィールドの一致確認
- ユーザー名: 必須入力
- メールアドレス重複チェック: 既存ユーザーとの重複確認

## テスト実行結果

### 実行環境の問題

テスト実行時にサンドボックス制限により、ポート5173へのバインドが許可されませんでした:

```
Error: listen EPERM: operation not permitted 127.0.0.1:5173
```

### TypeScript型チェック

テストコードの構文と型は正しいことを確認しました:

```bash
npx tsc --noEmit e2e/auth.spec.ts
# エラーなし
```

### 期待される失敗理由

実際のテスト実行環境では、以下の理由で全テストが失敗することが期待されます:

1. **ナビゲーションリンク未実装**
   - `[data-testid="login-link"]` が存在しない
   - `[data-testid="register-link"]` が存在しない

2. **コンポーネント未実装**
   - LoginFormコンポーネントが存在しない
   - RegisterFormコンポーネントが存在しない

3. **UI要素未実装**
   - すべての入力フィールド未実装
   - すべてのボタン未実装
   - エラーメッセージ表示機能未実装

4. **バリデーション未実装**
   - クライアントサイドバリデーション未実装
   - サーバーサイドバリデーション未実装

5. **ルーティング未実装**
   - `/login` ルート未設定
   - `/register` ルート未設定
   - `/dashboard` または `/home` ルート未設定

### 実装状況の検証 (2026-02-06 14:40)

現在の実装状況を確認しました:

```bash
# LoginForm/RegisterFormコンポーネントの検索
$ find src -name "*Login*.tsx" -o -name "*Register*.tsx"
# 結果: 0件 (未実装)

# App.tsxの確認
$ cat src/App.tsx
# 結果: TodoアプリのみでLoginForm/RegisterFormへの参照なし

# ルーティングライブラリの検索
$ grep -r "react-router" package.json
# 結果: なし (ルーティング未設定)
```

**確認結果**: 認証関連の実装は一切存在せず、全テストが失敗することが保証されています。

## TDD Red Phase チェックリスト

- [x] タスク要件を理解した
- [x] 既存のテストパターンを確認した（todo.spec.ts）
- [x] LoginFormの包括的なテストケースを作成した
- [x] RegisterFormの包括的なテストケースを作成した
- [x] 認証フロー統合のテストケースを作成した
- [x] data-testid命名規則を定義した
- [x] バリデーション要件を定義した
- [x] テストコードの構文を検証した（TypeScript型チェック）
- [x] 実装前のため全テストが失敗することを確認した（理論的に）
- [x] Red Phaseの記録を残した

## 次のステップ (Green Phase)

implementerエージェントが以下の実装を行う必要があります:

### 1. ルーティング設定
- React Router または類似のルーティングライブラリのセットアップ
- `/login`, `/register`, `/dashboard` ルートの定義

### 2. LoginFormコンポーネント実装
- メールアドレス入力フィールド
- パスワード入力フィールド
- パスワード表示/非表示トグル
- ログインボタン
- バリデーション機能
- エラーメッセージ表示
- API連携（ログイン処理）

### 3. RegisterFormコンポーネント実装
- ユーザー名入力フィールド
- メールアドレス入力フィールド
- パスワード入力フィールド
- パスワード確認入力フィールド
- パスワード表示/非表示トグル
- 登録ボタン
- バリデーション機能
- エラーメッセージ表示
- 成功メッセージ表示
- API連携（会員登録処理）

### 4. ナビゲーション実装
- ヘッダーまたはメニューにログイン/会員登録リンクを追加
- ログイン⇔会員登録の相互リンク実装

### 5. バックエンドAPI連携
- `/api/auth/login` エンドポイント連携
- `/api/auth/register` エンドポイント連携
- JWT トークン管理（必要に応じて）
- 認証状態管理（Context API、Redux等）

### 6. リファクタリング (Refactor Phase)
- 共通コンポーネントの抽出（InputField, Button等）
- バリデーションロジックの共通化
- エラーハンドリングの統一

## 備考

- プロジェクトは既にPlaywrightがセットアップされている
- 既存のtodo.spec.tsを参考にテストパターンを統一した
- React 19の最新機能を活用可能
- Vitによる高速なHMR環境が利用可能

## 参考

- 既存テスト: `frontend/e2e/todo.spec.ts`
- Playwright設定: `frontend/playwright.config.ts`
- プロジェクト構成: TypeScript + React + Vite + Playwright

## Red Phase 完了確認 (2026-02-06 14:45)

### 検証項目

- [x] テストファイルが存在する: `frontend/e2e/auth.spec.ts` (415行, 19KB)
- [x] テストケース数が正しい: 24テストケース
  - LoginForm: 9テストケース
  - RegisterForm: 13テストケース
  - 認証フロー統合: 2テストケース
- [x] TypeScript型チェックが通る: `npx tsc --noEmit e2e/auth.spec.ts` ✓
- [x] 実装コードが存在しない: LoginForm/RegisterFormコンポーネント未作成
- [x] ルーティングが未設定: react-routerパッケージなし
- [x] 全テストが失敗することを保証: 上記により理論的に保証

### テスト実行不可の理由

サンドボックス制限により、ポート5173へのバインドが許可されず、実際のテスト実行は不可能です。
しかし、TypeScript型チェックによりテストコードの構文は正しいこと、実装コードが一切存在しないことから、
テスト実行環境では全テストが失敗することが保証されています。

### 次のフェーズへの引き継ぎ

**Green Phase担当者(implementer)への指示**:

1. まず `react-router-dom` をインストールする
2. App.tsxにルーティングを設定する (`/`, `/login`, `/register`)
3. LoginFormコンポーネントを実装する
4. RegisterFormコンポーネントを実装する
5. テストを実行してGreenにする
6. リファクタリングフェーズに進む

**重要**: Red Phaseドキュメントに記載された`data-testid`命名規則とバリデーション要件を厳守すること。
